<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reserve Equipment</title>
    <!-- Add FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@3.2.0/dist/fullcalendar.min.css" rel="stylesheet">
</head>
<body>

<h2>Reserve Equipment: {{ equipment.name }}</h2>

<!-- Display a calendar for the equipment -->
<div id="calendar"></div>

<!-- Reservation form -->
<form action="{{ url_for('equipment_page', equipment_id=equipment.id) }}" method="POST" id="reservation_form">
    <label for="user_name">Your Name:</label>
    <input type="text" name="user_name" required><br><br>

    <label for="date">Reservation Date:</label>
    <input type="date" name="date" required><br><br>

    <div id="time-slots"></div>

    <button type="submit">Reserve Selected Time Slots</button>
</form>

<!-- Script for FullCalendar and handling clicks -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@3.2.0/dist/fullcalendar.min.js"></script>

<script>
    $(document).ready(function() {
        // Initialize the calendar
        $('#calendar').fullCalendar({
            events: {{ reservations|tojson }}, // Pass reservations directly to FullCalendar
            dayClick: function(date, jsEvent, view) {
                let selectedDate = date.format('YYYY-MM-DD');
                let timeSlots = {{ time_slots|tojson }};
                let timeSlotHtml = '';
                
                timeSlots.forEach(slot => {
                    timeSlotHtml += `
                    <label>
                        <input type="checkbox" name="selected_slots" value="${slot.start_time}-${slot.end_time}">
                        ${slot.start_time} - ${slot.end_time}
                    </label><br>
                    `;
                });

                $('#time-slots').html(timeSlotHtml);
                $('input[name="date"]').val(selectedDate);
            }
        });
    });
</script>

</body>
</html>
